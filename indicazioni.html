<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Display navigation directions</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
    
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.1.2/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.1.2/mapbox-gl.js"></script>
    <script src='https://unpkg.com/@turf/turf@6/turf.min.js'></script>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>

    <div id="map_navigazione"></div>

    <div class="controls-profile-switcher">
        <div class="profile-indicazioni walking active">
            <div class="icone-indicazioni walking-icon">
                <img class="walk-man" src="img/walk-man-active.svg" alt="walk-man" />
            </div>
            <p class="hyper txt-indicazioni duration-walking">- min</p>
        </div>
        
        <div class="profile-indicazioni cycling">
            <div class="icone-indicazioni cycling-icon">
                <img class="cycling-man" src="img/cycle-man.svg" alt="cycle-man" />
            </div>
            <p class="hyper txt-indicazioni duration-cycling">- min</p>
        </div>
        <div class="profile-indicazioni scooter">
            <div class="icone-indicazioni scooter-icon">
                <img class="scooter" src="img/scooter.svg" alt="scooter" />
            </div>
            <p class="hyper txt-indicazioni duration-scooter">- min</p>
        </div>
        <div class="selector-container">
            <div class="selector"></div>
        </div>
    </div>

    <!-- test mode -------------------------------------------------->
    <!-- <div class="overlay">
        <button id="mouse"><p class="hyper-bold" style="margin: 0;">Test Mode</p></button>
    </div>

    <div class="div_verifica_dentro_fuori" style="top:75% !important"><p class="dentro_fuori">loading</p></div> -->
    <!-- test mode -------------------------------------------------->


    <div class="destinazione_raggiunta not-visible">
        <div class="close-button-arrivato">
            <svg xmlns="http://www.w3.org/2000/svg" width="21" height="19" viewBox="0 0 21 19" fill="none">
                <path d="M11.3986 9.5L20 17.973L18.973 19L10.5 10.3986L2.02703 19L1 17.973L9.60135 9.5L1 1.02703L2.02703 0L10.5 8.60135L18.973 0L20 1.02703L11.3986 9.5Z" fill="black"/>
            </svg>
        </div>
        <div class="pin-map-container">
            <svg class="pin-map" xmlns="http://www.w3.org/2000/svg" width="16" height="23" viewBox="0 0 16 23" fill="none">
                <mask id="path-1-outside-1_239_1480" maskUnits="userSpaceOnUse" x="0.5" y="0.5" width="15" height="22" fill="black">
                <rect fill="white" x="0.5" y="0.5" width="15" height="22"/>
                <path fill-rule="evenodd" clip-rule="evenodd" d="M2.31006 11.1462L8.00003 21.5L13.69 11.1261C14.2209 10.168 14.4997 9.09052 14.5 7.99499C14.4968 5.27744 12.8045 2.84851 10.257 1.90489C7.70953 0.961272 4.84411 1.702 3.07251 3.76213C1.30091 5.82226 0.996824 8.76725 2.31006 11.1462ZM8 9C9.10457 9 10 8.10457 10 7C10 5.89543 9.10457 5 8 5C6.89543 5 6 5.89543 6 7C6 8.10457 6.89543 9 8 9Z"/>
                </mask>
                <path fill-rule="evenodd" clip-rule="evenodd" d="M2.31006 11.1462L8.00003 21.5L13.69 11.1261C14.2209 10.168 14.4997 9.09052 14.5 7.99499C14.4968 5.27744 12.8045 2.84851 10.257 1.90489C7.70953 0.961272 4.84411 1.702 3.07251 3.76213C1.30091 5.82226 0.996824 8.76725 2.31006 11.1462ZM8 9C9.10457 9 10 8.10457 10 7C10 5.89543 9.10457 5 8 5C6.89543 5 6 5.89543 6 7C6 8.10457 6.89543 9 8 9Z" fill="#FFF500"/>
                <path d="M8.00003 21.5L7.12365 21.9816L8.87681 21.9809L8.00003 21.5ZM2.31006 11.1462L3.18645 10.6645L3.18552 10.6629L2.31006 11.1462ZM13.69 11.1261L12.8153 10.6415L12.8132 10.6452L13.69 11.1261ZM14.5 7.99499L15.5 7.99529L15.5 7.9938L14.5 7.99499ZM10.257 1.90489L9.90969 2.84263L10.257 1.90489ZM3.07251 3.76213L3.83072 4.41415L3.07251 3.76213ZM8.87642 21.0184L3.18644 10.6645L1.43368 11.6278L7.12365 21.9816L8.87642 21.0184ZM12.8132 10.6452L7.12326 21.0191L8.87681 21.9809L14.5668 11.6071L12.8132 10.6452ZM13.5 7.99468C13.4997 8.92076 13.2641 9.83155 12.8153 10.6415L14.5647 11.6108C15.1778 10.5044 15.4996 9.26027 15.5 7.99529L13.5 7.99468ZM9.90969 2.84263C12.0651 3.64103 13.4973 5.69633 13.5 7.99617L15.5 7.9938C15.4963 4.85855 13.5439 2.05599 10.6044 0.967155L9.90969 2.84263ZM3.83072 4.41415C5.32981 2.6709 7.75429 2.04425 9.90969 2.84263L10.6044 0.967155C7.66477 -0.121704 4.35841 0.733097 2.31431 3.11012L3.83072 4.41415ZM3.18552 10.6629C2.07418 8.6497 2.33156 6.15747 3.83072 4.41415L2.31431 3.11012C0.270267 5.48706 -0.0805373 8.88481 1.4346 11.6294L3.18552 10.6629ZM9 7C9 7.55228 8.55228 8 8 8V10C9.65685 10 11 8.65685 11 7H9ZM8 6C8.55228 6 9 6.44772 9 7H11C11 5.34315 9.65685 4 8 4V6ZM7 7C7 6.44772 7.44772 6 8 6V4C6.34315 4 5 5.34315 5 7H7ZM8 8C7.44772 8 7 7.55228 7 7H5C5 8.65685 6.34315 10 8 10V8Z" fill="black" mask="url(#path-1-outside-1_239_1480)"/>
                <circle cx="8" cy="7" r="1.5" stroke="black"/>
            </svg>
        </div>
        <h5 class="firs txt-sei-arrivato">SEI GIUNT* A DESTINAZIONE!</h5>
    </div>

    <a href="#"> <svg class="menu-button" xmlns="http://www.w3.org/2000/svg" width="42" height="30" viewBox="0 0 42 27" fill="none">
        <rect x="1" y="1" width="40" height="4px" fill="#FFF500" stroke="black"/>
        <rect x="1" y="12" width="40" height="4px" fill="#FFF500" stroke="black"/>
        <rect x="1" y="23" width="40" height="4px" fill="#FFF500" stroke="black"/>
    </svg></a>

    <a href="index.html"><svg class="logo" xmlns="http://www.w3.org/2000/svg" width="102" height="28" viewBox="0 0 102 28" fill="none">
        <path d="M70.0344 0H72.8344V28H70.0344V0ZM71.4344 23.64H92.6744V28H71.4344V23.64ZM71.4344 0H99.7544V4.36H71.4344V0ZM98.3544 0H101.154V11.6H98.3544V0Z" fill="black"/>
        <path d="M35.3391 0H38.1391V28H35.3391V0ZM50.4191 18.48H53.2191V28H50.4191V18.48ZM36.7391 16.28H66.4591V20.64H36.7391V16.28ZM36.7391 0H65.0591V4.36H36.7391V0ZM63.6591 0H66.4591V18.48H63.6591V0Z" fill="black"/>
        <path d="M28.92 0H31.72V28H28.92V0ZM0.800003 0H3.6V28H0.800003V0ZM2.2 9H30.32V13.36H2.2V9ZM2.2 0H30.32V4.36H2.2V0Z" fill="black"/>
        </svg>
    </a>


    <!------------------------------------------------------------------------------------------ menu ---------------------------------------->

    <div class="div-menu">
        <a href="#">
            <svg class="close-button" xmlns="http://www.w3.org/2000/svg" width="24" height="25" viewBox="0 0 24 25" fill="none">
                <path d="M24 25L24 20.3329L4.20775 13.3589L4.20775 11.6406L24 4.66783L24 0L-4.60484e-07 8.4498L-1.16877e-06 16.5517L24 25Z" fill="black"/>
            </svg>
        </a>

        <div class="container-fluid container-content-menu">
            <div class="row row-mura-menu"></div>
            <div class="row row-mura-menu"></div>
            <div class="row row-mura-menu"></div>
            <div class="row row-mura-menu d-flex justify-content-center">
                <a class="link-b text-center m-0" href="#">
                    <h4 class="firs">LOGIN<td><nobr> &nbsp;></nobr></td></h4>
                </a>
            </div>
            <div class="row row-mura-menu"></div>
            <div class="row row-mura-menu"></div>
            <div class="row row-mura-menu"></div>
            <div class="row row-mura-menu d-flex justify-content-center">
                <a class="link-b text-center m-0" href="#">
                    <h4 class="firs">ABOUT<td><nobr> &nbsp;></nobr></td></h4>
                </a>
            </div>
            <div class="row row-mura-menu"></div>
            <div class="row row-mura-menu"></div>
            <div class="row row-mura-menu"></div>
            <div class="row row-mura-menu"></div>
        </div>

        <div class="container-fluid container-mura-menu">
            <div class="row row-mura-menu"></div>
            <div class="row row-mura-menu">
                <div class="col-11 d-flex align-items-end">
                    <div class="mura-menu-o"></div>
                </div>
            </div>
            <div class="row row-mura-menu">
                <div class="col-10"></div>
                <div class="col-1 d-flex justify-content-end">
                    <div class="mura-menu-v"></div>
                </div>
            </div>
            <div class="row row-mura-menu">
                <div class="col-10"></div>
                <div class="col-1 d-flex justify-content-end">
                    <div class="mura-menu-v"></div>
                </div>
            </div>
            <div class="row row-mura-menu">
                <div class="col-10"></div>
                <div class="col-1 d-flex justify-content-end">
                    <div class="mura-menu-v"></div>
                </div>
            </div>
            <div class="row row-mura-menu">
                <div class="col-1"></div>
                <div class="col-1 d-flex justify-content-end">
                    <div class="mura-menu-v"></div>
                </div>
                <div class="col-9">
                    <div class="mura-menu-o"></div>
                </div>
            </div>
            <div class="row row-mura-menu">
                <div class="col-1"></div>
                <div class="col-1 d-flex justify-content-end">
                    <div class="mura-menu-v"></div>
                </div>
            </div>
            <div class="row row-mura-menu">
                <div class="col-1"></div>
                <div class="col-1 d-flex justify-content-end">
                    <div class="mura-menu-v"></div>
                </div>
            </div>
            <div class="row row-mura-menu">
                <div class="col-1"></div>
                <div class="col-1 d-flex justify-content-end">
                    <div class="mura-menu-v"></div>
                </div>
            </div>
            <div class="row row-mura-menu">
                <div class="col-1"></div>
                <div class="col-1 d-flex justify-content-end">
                    <div class="mura-menu-v"></div>
                </div>
            </div>
            <div class="row row-mura-menu">
                <div class="col-1"></div>
                <div class="col-1 d-flex justify-content-end">
                    <div class="mura-menu-v"></div>
                </div>
            </div>
            <div class="row row-mura-menu">
                <div class="col-1"></div>
                <div class="col-1 d-flex justify-content-end">
                    <div class="mura-menu-v"></div>
                </div>
            </div>
        </div>
    </div>





    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.2.0/mapbox-gl-directions.js"></script>
    <script src="anime-master/lib/anime.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script>

        var user_lat;
        var user_lng;

        let id_posizione_aggiornata;
        var destinazione = { latitude: 43.91187814893709, longitude: 12.91044693538976 }

        let options;

        const area_destinazione = turf.polygon([[
                [
                12.910327638741819,
                43.91198433533337
                ],
                [
                12.910302189125149,
                43.91198343463602
                ],
                [
                12.91027698460449,
                43.91198074121824
                ],
                [
                12.910252267915363,
                43.91197628101937
                ],
                [
                12.910228277095026,
                43.91197009699397
                ],
                [
                12.91020524318997,
                43.911962248698075
                ],
                [
                12.910183388030758,
                43.911952811715736
                ],
                [
                12.910162922095605,
                43.91194187693096
                ],
                [
                12.910144042483324,
                43.91192954965252
                ],
                [
                12.910126931015126,
                43.91191594859965
                ],
                [
                12.910111752483578,
                43.911901204758756
                ],
                [
                12.91009865306557,
                43.9118854601219
                ],
                [
                12.910087758914571,
                43.911868866319246
                ],
                [
                12.910079174945748,
                43.91185158315885
                ],
                [
                12.910072983825634,
                43.911833777087494
                ],
                [
                12.910069245176064,
                43.9118156195878
                ],
                [
                12.910067995000082,
                43.911797285526625
                ],
                [
                12.910069245335269,
                43.911778951471106
                ],
                [
                12.910072984137917,
                43.91176079398813
                ],
                [
                12.910079175399115,
                43.91174298794393
                ],
                [
                12.910087759491597,
                43.911725704820086
                ],
                [
                12.91009865374408,
                43.91170911106198
                ],
                [
                12.910111753237501,
                43.911693366475944
                ],
                [
                12.910126931815483,
                43.91167862269019
                ],
                [
                12.910144043299363,
                43.911665021694674
                ],
                [
                12.910162922895966,
                43.911652694473574
                ],
                [
                12.910183388784679,
                43.91164175974393
                ],
                [
                12.91020524386848,
                43.91163232281242
                ],
                [
                12.910228277672052,
                43.911624474561066
                ],
                [
                12.910252268368732,
                43.91161829057221
                ],
                [
                12.910276984916775,
                43.91161383040051
                ],
                [
                12.91030218928435,
                43.911611136999454
                ],
                [
                12.910327638741819,
                43.91161023630775
                ],
                [
                12.910353088199289,
                43.911611136999454
                ],
                [
                12.910378292566863,
                43.91161383040051
                ],
                [
                12.910403009114908,
                43.91161829057221
                ],
                [
                12.910426999811587,
                43.911624474561066
                ],
                [
                12.91045003361516,
                43.91163232281242
                ],
                [
                12.91047188869896,
                43.91164175974393
                ],
                [
                12.910492354587674,
                43.911652694473574
                ],
                [
                12.910511234184277,
                43.911665021694674
                ],
                [
                12.910528345668155,
                43.91167862269019
                ],
                [
                12.910543524246139,
                43.911693366475944
                ],
                [
                12.910556623739557,
                43.91170911106198
                ],
                [
                12.910567517992042,
                43.911725704820086
                ],
                [
                12.910576102084525,
                43.91174298794393
                ],
                [
                12.910582293345723,
                43.91176079398813
                ],
                [
                12.910586032148371,
                43.911778951471106
                ],
                [
                12.910587282483556,
                43.911797285526625
                ],
                [
                12.910586032307574,
                43.9118156195878
                ],
                [
                12.910582293658006,
                43.911833777087494
                ],
                [
                12.910576102537892,
                43.91185158315885
                ],
                [
                12.910567518569069,
                43.911868866319246
                ],
                [
                12.910556624418069,
                43.9118854601219
                ],
                [
                12.91054352500006,
                43.911901204758756
                ],
                [
                12.910528346468512,
                43.91191594859965
                ],
                [
                12.910511235000314,
                43.91192954965252
                ],
                [
                12.910492355388035,
                43.91194187693096
                ],
                [
                12.910471889452882,
                43.911952811715736
                ],
                [
                12.910450034293667,
                43.911962248698075
                ],
                [
                12.910427000388616,
                43.91197009699397
                ],
                [
                12.910403009568276,
                43.91197628101937
                ],
                [
                12.910378292879148,
                43.91198074121824
                ],
                [
                12.91035308835849,
                43.91198343463602
                ],
                [
                12.910327638741819,
                43.91198433533337
                ]
        ]]);


        // ------------------------------------------------------------------------------------------------------------------------------------------------ test mode

        const origin = [12.910316279411177, 43.91162447859239];

        var user_test = {
            'type': 'FeatureCollection',
            'features': [
                {
                    'type': 'Feature',
                    'properties': {},
                    'geometry': {
                        'type': 'Point',
                        'coordinates': origin
                    }
                }
            ]
        };

        // ------------------------------------------------------------------------------------------------------------------------------------------------ test mode

        let mouse = false;
        var mouse_pos = {};

        mapboxgl.accessToken = 'pk.eyJ1Ijoibmljb2xvc2luYXRyYSIsImEiOiJjbGs4ZTd0aWowaXNqM2ZybzEzYmplaGF3In0.zJYGpj2MF2Nw8M8XHuXc8Q';
        let map_navigazione = new mapboxgl.Map({
            container: 'map_navigazione', // container ID
            style: 'mapbox://styles/nicolosinatra/clmnjwye901wi01r4h6n9fekx', // style URL
            center: [12.909, 43.909],
            zoom: 15.3
        });

        var NavigationControl = new mapboxgl.NavigationControl({
            showCompass: true,
            showZoom: false
        })

        // Add zoom and rotation controls to the map.
        map_navigazione.addControl(NavigationControl);

        const directions = new MapboxDirections({
            accessToken: mapboxgl.accessToken,
            profile: 'mapbox/walking',
            controls: {
                profileSwitcher: false,
                inputs: false,
                instructions: false,
            },
            language: 'it-IT',
            interactive: false,
            unit: 'metric',
            // profile: 'mapbox/cycling'
            });

        map_navigazione.addControl(directions);


        const geolocate = new mapboxgl.GeolocateControl({
            positionOptions: {
                enableHighAccuracy: true
            },
            // When active the map will receive updates to the device's location as it changes.
            trackUserLocation: true,
            // Draw an arrow next to the location dot to indicate which direction the device is heading.
            showUserHeading: true
        });
        // Add the control to the map.
        map_navigazione.addControl(geolocate);

        // definire stile del navigatore
        map_navigazione.on('load',  function() {
            map_navigazione.setLayoutProperty('nomi-economia-corporativa', 'visibility', 'visible');
            map_navigazione.setLayoutProperty('icone-economia-corporativa', 'visibility', 'visible');
            map_navigazione.moveLayer('icone-economia-corporativa');
            map_navigazione.moveLayer('nomi-economia-corporativa');

            map_navigazione.setPaintProperty('directions-route-line-alt', 'line-color', '#fff500');

            map_navigazione.setPaintProperty('directions-route-line-casing', 'line-color', '#000');
            map_navigazione.setPaintProperty('directions-route-line-casing', 'line-width', 6);
            
            map_navigazione.setPaintProperty('directions-route-line', 'line-color', '#fff500');
            map_navigazione.setPaintProperty('directions-route-line', 'line-width', 4);


            map_navigazione.setLayoutProperty('directions-hover-point-casing', 'visibility', 'none');
            map_navigazione.setLayoutProperty('directions-hover-point', 'visibility', 'none');
            map_navigazione.setLayoutProperty('directions-waypoint-point-casing', 'visibility', 'none');
            map_navigazione.setLayoutProperty('directions-waypoint-point', 'visibility', 'none');
            map_navigazione.setLayoutProperty('directions-origin-point', 'visibility', 'none');
            map_navigazione.setLayoutProperty('directions-origin-label', 'visibility', 'none');
            map_navigazione.setLayoutProperty('directions-destination-point', 'visibility', 'none');
            map_navigazione.setLayoutProperty('directions-destination-label', 'visibility', 'none');

            geolocate.trigger();

            directions.setDestination([destinazione.longitude, destinazione.latitude]); 

            id_posizione_aggiornata = navigator.geolocation.watchPosition(success, error, options); 


            // ------------------------------------------------------------------------------------------------------------------------------------------------ test mode

            //  <------ add questo per disattivare

            map_navigazione.loadImage('https://upload.wikimedia.org/wikipedia/commons/thumb/6/60/Cat_silhouette.svg/400px-Cat_silhouette.svg.png', (error, image) => {
                if (error) throw error;
                if (!map.hasImage('cat')) map.addImage('cat', image);
            });

            map_navigazione.addSource('point', {
                'type': 'geojson',
                'data': user_test
            });

            // rende visibile il punto creato definendone lo stile sulla mappa (cat)
            map_navigazione.addLayer({
            'id': 'point',
            'source': 'point',
            'type': 'symbol',
            'layout': {
                // This icon is a part of the Mapbox Streets style.
                // To view all images available in a Mapbox style, open
                // the style in Mapbox Studio and click the "Images" tab.
                // To add a new image to the style at runtime see
                // https://docs.mapbox.com/mapbox-gl-js/example/add-image/
                'icon-image': 'cat',
                'icon-size': 0.1,
                'icon-rotate': ['get', 'bearing'],
                'icon-rotation-alignment': 'map',
                'icon-allow-overlap': true,
                'icon-ignore-placement': true
            }
            });

            document.getElementById('mouse').addEventListener('click', () => {
                if (mouse){
                    mouse = false;
                    $('#mouse').removeClass('active');
                } else {
                    mouse = true;
                    $('#mouse').addClass('active');
                }
            });


            map_navigazione.on('mousemove', (e) => {
                const json = JSON.stringify(e.lngLat.wrap());
                const json_obj = JSON.parse(json);
                mouse_pos = json_obj;
                let mouse_lat = mouse_pos.lat;
                let mouse_lng = mouse_pos.lng;
                // `e.point` is the x, y coordinates of the `mousemove` event
                // relative to the top-left corner of the map.
                // document.getElementById('info').innerHTML = JSON.stringify(e.lngLat.wrap()) + JSON.stringify(e.point);

                if (mouse){
                    user_test.features[0].geometry.coordinates = [mouse_lng, mouse_lat];
                    // Update the source with this new data
                    map_navigazione.getSource('point').setData(user_test);

                    let user_lng = mouse_lng;
                    let user_lat = mouse_lat;
                    
                    // Verificare se e dentro quale campo sonoro si trova l'utente
                    let user_turf = turf.point([parseFloat(user_lng), parseFloat(user_lat)]);
                    // console.log("user dentro:"+ turf.booleanPointInPolygon(user_turf, campo_sonoro_fronte_economia_corporativa));
                
                    if(turf.booleanPointInPolygon(user_turf, area_destinazione)){
                        console.log('sei_arrivato');
                        $('.destinazione_raggiunta').removeClass('not-visible');
                    }else{
                       
                    }
                }
            });

            // add questo per disattivare  ------> 

           // ------------------------------------------------------------------------------------------------------------------------------------------------ test mode


        })

        // hacky workaround for the fact that mapbox doesn't let you disable camera auto-tracking
        // geolocate._updateCamera = () => {}
        // map_navigazione.addControl(geolocate)
        

        function success(pos) {
            const user_crd = pos.coords;
            user_lng = user_crd.longitude;
            user_lat = user_crd.latitude;
        
            // map_navigazione.setCenter([user_lng, user_lat]);

            console.log("Your current position is:");
            console.log("Latitude : " + user_lat);
            console.log(`Longitude: ${user_lng}`);
            console.log(`More or less ${user_crd.accuracy} meters.`);

            directions.setOrigin([user_lng, user_lat]);

            

            if (check && stato_indicazioni === 'walking'){
                data_directions = directions._store.getState();
                tempo_a_piedi = Math.round(data_directions.directions[0].duration / 60);
                
                var tempo_in_bici = Math.round(tempo_a_piedi/3);
                let tempo_in_monopattino = Math.round(tempo_a_piedi/4);

                $('.duration-walking').text(tempo_a_piedi + 'min');
                $('.duration-cycling').text(tempo_in_bici + 'min');
                $('.duration-scooter').text(tempo_in_monopattino + 'min');

                adatta_larrghezza('profile-indicazioni.active');
            }

            // usare turf per verificare se sono arrivato a destinazione

            var user = turf.point([parseFloat(user_lng), parseFloat(user_lat)]);
            console.log("user dentro:"+ turf.booleanPointInPolygon(user, area_destinazione));
        
            if(turf.booleanPointInPolygon(user, area_destinazione)){
                jQuery(".dentro_fuori").text("arrivato, " + user_lng + ", "+ user_lat);
                $('.destinazione_raggiunta').removeClass('not-visible');
            }else{
                jQuery(".dentro_fuori").text("fuori, " + user_lng + ", "+ user_lat);
            }
        }
        
        function error(err) {
            console.error(`ERROR(${err.code}): ${err.message}`);
        }
        
        options = {
            enableHighAccuracy: true,
            timeout: 5000,
            maximumAge: 0,
        };

        var check = false;
        var tempo_a_piedi;
        var data_directions;
        // Set an event listener that fires
        // when the map is drawn to the screen.
        map_navigazione.on('idle', () => {

            data_directions = directions._store.getState();
            tempo_a_piedi = Math.round(data_directions.directions[0].duration / 60);

            if (tempo_a_piedi != undefined && check == false){
                var tempo_in_bici = Math.round(tempo_a_piedi/3);
                let tempo_in_monopattino = Math.round(tempo_a_piedi/4);

                $('.duration-walking').text(tempo_a_piedi + 'min');
                $('.duration-cycling').text(tempo_in_bici + 'min');
                $('.duration-scooter').text(tempo_in_monopattino + 'min');

                adatta_larrghezza('profile-indicazioni.active');

                if(isNaN(tempo_a_piedi)){
                    check = false;
                }else{
                    check = true;
                }
            }
        });

        var stato_indicazioni = 'walking';
        
        $('.walking').click(function(){
            stato_indicazioni = 'walking';
            directions.actions.setProfile('mapbox/walking');
            $('.cycling').removeClass('active');
            $('.scooter').removeClass('active');
            
            $('.icone-indicazioni img').remove();
            $("<img>").attr("src", "img/cycle-man.svg")
                .addClass("cycle-man")
                .appendTo(".cycling-icon");
            $("<img>").attr("src", "img/scooter.svg")
                .addClass("scooter")
                .appendTo(".scooter-icon");


            anime({
                targets: '.selector',
                left: '0%',
                translateX: '0',
                duration: 200,
                easing: 'easeInOutQuad'
            });

            setTimeout(function(){
                $("<img>").attr("src", "img/walk-man-active.svg")
                .addClass("walk-man")
                .addClass("active")
                .appendTo(".walking-icon");
                
                $('.walking').addClass('active');
            }, 200);

            
            // $('.selector-container').css('justify-content', 'flex-start');

            adatta_larrghezza('profile-indicazioni.walking');
        });

        $('.cycling').click(function(){
            stato_indicazioni = 'cycling';
            directions.actions.setProfile('mapbox/cycling');
            $('.walking').removeClass('active');
            $('.scooter').removeClass('active');

            $('.icone-indicazioni img').remove();
            $("<img>").attr("src", "img/walk-man.svg")
                .addClass("walk-man")
                .appendTo(".walking-icon");
            $("<img>").attr("src", "img/scooter.svg")
                .addClass("scooter")
                .appendTo(".scooter-icon");

            anime({
                targets: '.selector',
                left: '50%',
                translateX: '-50%',
                duration: 200,
                easing: 'easeInOutQuad'
            });

            setTimeout(function(){
                $("<img>").attr("src", "img/cycle-man-active.svg")
                .addClass("cycle-man")
                .addClass("active")
                .appendTo(".cycling-icon");
                
                $('.cycling').addClass('active');
            }, 200);
            //$('.selector-container').css('justify-content', 'center');

            adatta_larrghezza('profile-indicazioni.cycling');
        });

        $('.scooter').click(function(){
            stato_indicazioni = 'scooter';
            directions.actions.setProfile('mapbox/cycling');
            $('.walking').removeClass('active');
            $('.cycling').removeClass('active');

            $('.icone-indicazioni img').remove();
            $("<img>").attr("src", "img/walk-man.svg")
                .addClass("walk-man")
                .appendTo(".walking-icon");
            $("<img>").attr("src", "img/cycle-man.svg")
                .addClass("cycle-man")
                .appendTo(".cycling-icon");

            anime({
                targets: '.selector',
                left: '100%',
                translateX: '-100%',
                duration: 200,
                easing: 'easeInOutQuad'
            });

            setTimeout(function(){
                $("<img>").attr("src", "img/scooter-active.svg")
                .addClass("scooter")
                .addClass("active")
                .appendTo(".scooter-icon");
                
                $('.scooter').addClass('active');
            }, 200);
            //$('.selector-container').css('justify-content', 'flex-end');

            adatta_larrghezza('profile-indicazioni.scooter');
        });

        $('.close-button-arrivato').click(function(){
            $('.destinazione_raggiunta').fadeOut(500);
            $('.controls-profile-switcher').fadeOut(500);

            map_navigazione.setPaintProperty('directions-route-line-alt', 'line-opacity-transition', { duration: 300 });
            map_navigazione.setPaintProperty('directions-route-line-casing', 'line-opacity-transition', { duration: 100 });
            map_navigazione.setPaintProperty('directions-route-line', 'line-opacity-transition', { duration: 300 });

            map_navigazione.setPaintProperty('directions-route-line-alt', 'line-opacity', 0);
            map_navigazione.setPaintProperty('directions-route-line-casing', 'line-opacity', 0);
            map_navigazione.setPaintProperty('directions-route-line', 'line-opacity', 0);

            setTimeout(500, function(){
                $('.destinazione_raggiunta').addClass('not-visible');
                $('.controls-profile-switcher').addClass('not-visible');
            }); 
            
            
            
        });

        var larghezza_contenitore;

        function adatta_larrghezza(contenitore){
            larghezza_contenitore = $("." + contenitore).outerWidth();
	        $('.selector').css('width', larghezza_contenitore + 20); // 20 --> margini dx e sx del div attivo
        }

       
    </script>
    
</body>
</html>