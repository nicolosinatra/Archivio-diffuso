<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Display navigation directions</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
    
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.1.2/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.1.2/mapbox-gl.js"></script>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
<script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.2.0/mapbox-gl-directions.js"></script>
<link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.2.0/mapbox-gl-directions.css" type="text/css">





<div id="map_navigazione"></div>
<div class="controls-profile-switcher">
    <div class="profile-indicazioni">
        <div class="icone-indicazioni walking"></div>
        <p class="hyper txt-indicazioni">walking</p>
    </div>
    <div class="profile-indicazioni">
        <div class="icone-indicazioni cycling"></div>
        <p class="hyper txt-indicazioni">cycling</p>
    </div>
    <div class="profile-indicazioni">
        <div class="icone-indicazioni scooter"></div>
        <p class="hyper txt-indicazioni">scooter</p>
    </div>
</div>

<a href="#"> <svg class="menu-button" xmlns="http://www.w3.org/2000/svg" width="42" height="30" viewBox="0 0 42 27" fill="none">
    <rect x="1" y="1" width="40" height="4px" fill="#FFF500" stroke="black"/>
    <rect x="1" y="12" width="40" height="4px" fill="#FFF500" stroke="black"/>
    <rect x="1" y="23" width="40" height="4px" fill="#FFF500" stroke="black"/>
</svg></a>

<a href="index.html"><svg class="logo" xmlns="http://www.w3.org/2000/svg" width="102" height="28" viewBox="0 0 102 28" fill="none">
    <path d="M70.0344 0H72.8344V28H70.0344V0ZM71.4344 23.64H92.6744V28H71.4344V23.64ZM71.4344 0H99.7544V4.36H71.4344V0ZM98.3544 0H101.154V11.6H98.3544V0Z" fill="black"/>
    <path d="M35.3391 0H38.1391V28H35.3391V0ZM50.4191 18.48H53.2191V28H50.4191V18.48ZM36.7391 16.28H66.4591V20.64H36.7391V16.28ZM36.7391 0H65.0591V4.36H36.7391V0ZM63.6591 0H66.4591V18.48H63.6591V0Z" fill="black"/>
    <path d="M28.92 0H31.72V28H28.92V0ZM0.800003 0H3.6V28H0.800003V0ZM2.2 9H30.32V13.36H2.2V9ZM2.2 0H30.32V4.36H2.2V0Z" fill="black"/>
    </svg>
</a>


<!------------------------------------------------------------------------------------------ menu ---------------------------------------->

<div class="div-menu">
    <a href="#">
        <svg class="close-button" xmlns="http://www.w3.org/2000/svg" width="24" height="25" viewBox="0 0 24 25" fill="none">
            <path d="M24 25L24 20.3329L4.20775 13.3589L4.20775 11.6406L24 4.66783L24 0L-4.60484e-07 8.4498L-1.16877e-06 16.5517L24 25Z" fill="black"/>
        </svg>
    </a>

    <div class="container-fluid container-content-menu">
        <div class="row row-mura-menu"></div>
        <div class="row row-mura-menu"></div>
        <div class="row row-mura-menu"></div>
        <div class="row row-mura-menu d-flex justify-content-center">
            <a class="link-b text-center m-0" href="#">
                <h4 class="violet">LOGIN<td><nobr> &nbsp;></nobr></td></h4>
            </a>
        </div>
        <div class="row row-mura-menu"></div>
        <div class="row row-mura-menu"></div>
        <div class="row row-mura-menu"></div>
        <div class="row row-mura-menu d-flex justify-content-center">
            <a class="link-b text-center m-0" href="#">
                <h4 class="violet">ABOUT<td><nobr> &nbsp;></nobr></td></h4>
            </a>
        </div>
        <div class="row row-mura-menu"></div>
        <div class="row row-mura-menu"></div>
        <div class="row row-mura-menu"></div>
        <div class="row row-mura-menu"></div>
    </div>

    <div class="container-fluid container-mura-menu">
        <div class="row row-mura-menu"></div>
        <div class="row row-mura-menu">
            <div class="col-11 d-flex align-items-end">
                <div class="mura-menu-o"></div>
            </div>
        </div>
        <div class="row row-mura-menu">
            <div class="col-10"></div>
            <div class="col-1 d-flex justify-content-end">
                <div class="mura-menu-v"></div>
            </div>
        </div>
        <div class="row row-mura-menu">
            <div class="col-10"></div>
            <div class="col-1 d-flex justify-content-end">
                <div class="mura-menu-v"></div>
            </div>
        </div>
        <div class="row row-mura-menu">
            <div class="col-10"></div>
            <div class="col-1 d-flex justify-content-end">
                <div class="mura-menu-v"></div>
            </div>
        </div>
        <div class="row row-mura-menu">
            <div class="col-1"></div>
            <div class="col-1 d-flex justify-content-end">
                <div class="mura-menu-v"></div>
            </div>
            <div class="col-9">
                <div class="mura-menu-o"></div>
            </div>
        </div>
        <div class="row row-mura-menu">
            <div class="col-1"></div>
            <div class="col-1 d-flex justify-content-end">
                <div class="mura-menu-v"></div>
            </div>
        </div>
        <div class="row row-mura-menu">
            <div class="col-1"></div>
            <div class="col-1 d-flex justify-content-end">
                <div class="mura-menu-v"></div>
            </div>
        </div>
        <div class="row row-mura-menu">
            <div class="col-1"></div>
            <div class="col-1 d-flex justify-content-end">
                <div class="mura-menu-v"></div>
            </div>
        </div>
        <div class="row row-mura-menu">
            <div class="col-1"></div>
            <div class="col-1 d-flex justify-content-end">
                <div class="mura-menu-v"></div>
            </div>
        </div>
        <div class="row row-mura-menu">
            <div class="col-1"></div>
            <div class="col-1 d-flex justify-content-end">
                <div class="mura-menu-v"></div>
            </div>
        </div>
        <div class="row row-mura-menu">
            <div class="col-1"></div>
            <div class="col-1 d-flex justify-content-end">
                <div class="mura-menu-v"></div>
            </div>
        </div>
    </div>
</div>






<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<script>

    var user_lat;
    var user_lng;

    let id_posizione_aggiornata;
    var destinazione = { latitude: 43.91187814893709, longitude: 12.91044693538976 }

    let options;

    mapboxgl.accessToken = 'pk.eyJ1Ijoibmljb2xvc2luYXRyYSIsImEiOiJjbGs4ZTd0aWowaXNqM2ZybzEzYmplaGF3In0.zJYGpj2MF2Nw8M8XHuXc8Q';
    let map_navigazione = new mapboxgl.Map({
        container: 'map_navigazione', // container ID
        style: 'mapbox://styles/nicolosinatra/clmnjwye901wi01r4h6n9fekx', // style URL
        center: [12.909, 43.909],
        zoom: 14.3
    });

    var NavigationControl = new mapboxgl.NavigationControl({
        showCompass: true,
        showZoom: false
    })

    // Add zoom and rotation controls to the map.
    map_navigazione.addControl(NavigationControl);

    var MapboxDirections = new MapboxDirections({
        accessToken: mapboxgl.accessToken,
        profile: 'mapbox/walking',
        controls: {
          profileSwitcher: false,
          inputs: false,
          instructions: false,
        },
        language: 'it-IT',
        unit: 'metric',
        // profile: 'mapbox/cycling'
        });

    map_navigazione.addControl(MapboxDirections);
    
    // definire stile del navigatore
    map_navigazione.on('load',  function() {
        map_navigazione.setLayoutProperty('nomi-economia-corporativa', 'visibility', 'visible');
        map_navigazione.setLayoutProperty('icone-economia-corporativa', 'visibility', 'visible');
        map_navigazione.moveLayer('icone-economia-corporativa');
        map_navigazione.moveLayer('nomi-economia-corporativa');

        map_navigazione.setPaintProperty('directions-route-line-alt', 'line-color', '#fff500');

        map_navigazione.setPaintProperty('directions-route-line-casing', 'line-color', '#000');
        map_navigazione.setPaintProperty('directions-route-line-casing', 'line-width', 6);
        
        map_navigazione.setPaintProperty('directions-route-line', 'line-color', '#fff500');
        map_navigazione.setPaintProperty('directions-route-line', 'line-width', 4);


        map_navigazione.setLayoutProperty('directions-hover-point-casing', 'visibility', 'none');
        map_navigazione.setLayoutProperty('directions-hover-point', 'visibility', 'none');
        map_navigazione.setLayoutProperty('directions-waypoint-point-casing', 'visibility', 'none');
        map_navigazione.setLayoutProperty('directions-waypoint-point', 'visibility', 'none');
        map_navigazione.setLayoutProperty('directions-origin-point', 'visibility', 'none');
        map_navigazione.setLayoutProperty('directions-origin-label', 'visibility', 'none');
        map_navigazione.setLayoutProperty('directions-destination-point', 'visibility', 'none');
        map_navigazione.setLayoutProperty('directions-destination-label', 'visibility', 'none');
    })

    const geolocate = new mapboxgl.GeolocateControl({
        positionOptions: {
            enableHighAccuracy: true
        },
        // When active the map will receive updates to the device's location as it changes.
        trackUserLocation: true,
        // Draw an arrow next to the location dot to indicate which direction the device is heading.
        showUserHeading: true
    });
    // Add the control to the map.
    map_navigazione.addControl(geolocate);

    map_navigazione.on('load', () => {
        geolocate.trigger();      
    });


    // hacky workaround for the fact that mapbox doesn't let you disable camera auto-tracking
    // geolocate._updateCamera = () => {}
    // map_navigazione.addControl(geolocate)
    

    
    function success(pos) {
        const user_crd = pos.coords;
        user_lng = user_crd.longitude;
        user_lat = user_crd.latitude;
    
        map_navigazione.setCenter([user_lng, user_lat]);
        console.log("Your current position is:");
        console.log("Latitude : " + user_lat);
        console.log(`Longitude: ${user_lng}`);
        console.log(`More or less ${user_crd.accuracy} meters.`);
    
        MapboxDirections.setOrigin([user_lng, user_lat]);
        MapboxDirections.setDestination([destinazione.longitude, destinazione.latitude]);

    
        // verificare se sono arrivato a destinazione
        if (destinazione.latitude === user_crd.latitude && destinazione.longitude === user_crd.longitude) {
            console.log("Congratulations, you reached the target");
            navigator.geolocation.clearWatch(id);
        }
    }
    
    function error(err) {
        console.error(`ERROR(${err.code}): ${err.message}`);
    }
    
    options = {
        enableHighAccuracy: true,
        timeout: 5000,
        maximumAge: 0,
    };
    
    id_posizione_aggiornata = navigator.geolocation.watchPosition(success, error, options); 

    $('.cycling').click(function(){
        MapboxDirections.options.profile = 'mapbox/cycling';
        map_navigazione.addControl(MapboxDirections);
    });
  

</script>
 
</body>
</html>